# 6. 타입스크립트 컴파일

## 6.1 자바스크립트의 런타임과 타입스크립트의 컴파일

### 1. 런타임과 컴파일타임
고수준 언어인 자스는 컴파일러나 인터프리터에 의해 저수준 프로그래밍 언어로 번역돼 실행된다

컴파일타임 : 소스코드가 컴파일 과정을 거쳐 기계어 코드(바이트 코드)로 변환돼 실행할 수 있는 프로그램이 되는 과정

런타임 : 소스코드의 컴파일이 완료되면 응용 프로그램이 메모리에 적재돼 사용자에 의해 실행되는 과정

### 2. 자바스크립트 런타임

자스 런타임 : 자스가 실행되는 환경

주요 구성 요소 : 자스 엔진, 웹 API, 콜백 큐, 이벤트 루프

자스에도 컴파일 단계 존재함

### 3. 타입스크립트의 컴파일

타스는 tsc(컴파일러)를 통해 자스 코드로 변환된다

고수준 언어가 저수준 언어로 변환되는게 아니라 고수준 언어가 다른 고수준 언어로 변환되는 것이기 때문에 트랜스파일 이라고 부르기도 한다.

타스 컴파일 타임
1. 타스 소스코드를 타스 ast로 만든다
2. 타입 검사기가 ast를 확인해 타입을 확인한다
3. 타스 ast를 자스 소스로 변환한다
4. 자스 소스코드를 자스 ast로 만든다
5. ast가 바이트 코드로 변환된다
6. 런타임에서 바이트 코드가 평가돼 프로그램이 실행된다


## 6.2 타입스크립트 컴파일러의 동작

### 1. 코드 검사기로서의 타입스크립트 컴파일러(타입 검사기)

tsc는 코드에 문법 에러와 타입 에러를 모두 잡는다.

tsc는 tsc binder를 사용해 타입 검사를 한다.

### 2. 코드 변환기로서의 타입스크립트 컴파일러(트랜스파일러)

tsc의 target 옵션을 사용해 특정 버전의 자스 소스코드로 컴파일할 수 있다.

tsc는 코드 변환을 할때 타입 오류가 있더라도 일단 컴파일을 진행한다. 이 변환 과정은 타입 검사와 독립적으로 동작하기 때문.

```
const  name:  string  =  "zig";
// Type ‘string’ is not assignable to type ‘number’
const  age:  number  =  "zig";
```
age 변수를 number 타입으로 선언해 문자열을 할당했을때 타입 에러 발생. 하지만 자스로 컴파일 할 수는 있다.
```
const  name  =  "zig";
const  age  =  "zig";
```
위의 코드를 tsc로 컴파일한 자스 코드

## 6.3 타입스크립트 컴파일러의 구조

컴파일러는 하나의 프로그램으로, 이를 구현한 소스 파일이 존재한다.

### 1. 프로그램(Program)


컴파일시 전체적인 컴파일 과정을 관리하는 프로그램 객체가 생성된다.

컴파일할 타스 소스 파일과 소스 파일 내에서 import 된 파일을 불러오는데, 가장 최초로 불러온 파일을 기준으로 컴파일이 시작된다.

### 2. 스캐너(Scanner)

.ts 토큰화

타스 소스 파일을 **어휘적으로 분석** -> 토큰 생성

### 3. 파서(Parser)

토큰 기반 ast 생성

생성된 토큰 정보를 이용해 **구문적 분석** -> ast 생성

ast 최상위 노드 : 타스 소스 파일
ast 최하위 노드 : 파일의 끝 지점

### 4. 바인더(Binder)

ast 노드 기반 심볼 생성

체커 단계에서 타입 검사를 할 수 있도록 기반 마련. 심볼(데이터 구조 생성).

심볼은 이전 단계의 ast에서 선언된 타입의 노드 정보를 저장


### 5. 체커(Checker)와 이미터(Emmiter)

**체커** - ast + 심볼 기반 타입 검사

ast 노드를 탐색하면서 심볼 정보를 불러와 주어진 소스 파일에 대해 타입 검사.

체커의 타입 검사는 이미터에서 실행


**이미터** - ast + 코드 검사 기반 .js 생성

타스 소스 파일로 자스 파일(js)과 타입 선언 파일(d.ts) 생성

체커를 통해 코드에 대한 타입 검증 정보 가져온다.
